<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Users Details</title>
    <style>
        * {
            box-sizing: border-box;
        }

        html,
        body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 1100px;
            margin: 32px auto;
            padding: 16px;
            font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto,
                "Helvetica Neue", Arial;
            color: #222;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        header h1 {
            margin: 0 0 8px 0;
            font-size: 1.5rem;
            letter-spacing: -0.01em;
        }

        .controls {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin: 12px 0 18px 0;
            align-items: center;
            justify-content: center;
        }

        .controls input[type="search"] {
            padding: 8px 10px;
            border-radius: 8px;
            border: 1px solid #d0d7de;
            min-width: 180px;
            font-size: 0.95rem;
        }

        .controls button {
            padding: 8px 12px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            background: #0b5fff;
            color: white;
            box-shadow: 0 2px 6px rgba(11, 95, 255, 0.12);
            transition: all 0.2s ease;
        }

        .controls button:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 4px 12px rgba(11, 95, 255, 0.2);
        }

        .controls button:active {
            transform: translateY(0px) scale(0.98);
            box-shadow: 0 2px 6px rgba(11, 95, 255, 0.12);
        }

        .controls button.secondary {
            background: #eef2ff;
            color: #0b5fff;
            border: 1px solid #dbeafe;
            box-shadow: none;
        }

        .table-wrap {
            width: 100%;
            overflow-x: auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 6px 18px rgba(16, 24, 40, 0.06);
        }

        table {
            border-collapse: collapse;
            width: 100%;
            min-width: 760px;
        }

        thead th {
            text-align: left;
            padding: 12px 16px;
            font-size: 0.95rem;
            background: linear-gradient(90deg, #f8fafc, #ffffff);
            border-bottom: 1px solid #eef2f7;
        }

        tbody td {
            padding: 12px 16px;
            border-bottom: 1px solid #f2f6f9;
            vertical-align: top;
            font-size: 0.95rem;
        }

        tbody tr:nth-child(even) {
            background: #fff;
        }

        tbody tr:nth-child(odd) {
            background: #fbfdff;
        }

        tbody tr:hover {
            background: #f1f8ff;
        }

        #status {
            margin-top: 10px;
            font-size: 0.92rem;
            color: #555;
        }

        a {
            color: inherit;
            text-decoration: underline;
        }

        @media (max-width: 600px) {

            .controls input[type="search"],
            .controls select {
                min-width: 120px;
            }

            thead th,
            tbody td {
                padding: 10px 12px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>Users Directory</h1>
        </header>
    </div>
    <div class="controls">
        <input id="searchInput" type="search" placeholder="Search users..." />
        <button id="searchBtn">Search</button>
        <button id="clearBtn" class="secondary">Clear</button>
    </div>

    <div class="table-wrap">
        <table>
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Username</th>
                    <th>Email</th>
                    <th>Address</th>
                    <th>Phone</th>
                    <th>Website</th>
                    <th>Company</th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>
    <p id="status">Loading users...</p>
    <script>
        const API_URL = "https://jsonplaceholder.typicode.com/users";

        // Keep the fetched users in a variable
        let users = [];

        // Grab DOM nodes
        const tableBody = document.getElementById('tableBody');
        const statusEl = document.getElementById('status');
        const searchInput = document.getElementById('searchInput');
        const searchBtn = document.getElementById('searchBtn');
        const clearBtn = document.getElementById('clearBtn');

        // Escape HTML (same as before)
        function escapeHtml(str) {
            if (str === null || str === undefined) return '';
            return String(str)
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/\"/g, '&quot;')
                .replace(/'/g, '&#39;');
        }

        // Format address (same as before)
        function formatAddress(addr) {
            if (!addr) return '';
            const parts = [addr.street, addr.suite, addr.city, addr.zipcode].filter(Boolean);
            return parts.join(', ');
        }

        // Render table (same as before)
        function renderTable(list) {
            tableBody.innerHTML = '';
            if (!list || list.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="7">No users found.</td></tr>';
                return;
            }
            list.forEach(user => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
      <td>${escapeHtml(user.name)}</td>
      <td>${escapeHtml(user.username)}</td>
      <td><a href="mailto:${escapeHtml(user.email)}">${escapeHtml(user.email)}</a></td>
      <td>${escapeHtml(formatAddress(user.address))}</td>
      <td><a href="tel:${escapeHtml(user.phone)}">${escapeHtml(user.phone)}</a></td>
      <td><a href="http://${escapeHtml(user.website)}" target="_blank" rel="noopener noreferrer">${escapeHtml(user.website)}</a></td>
      <td>${escapeHtml(user.company && user.company.name ? user.company.name : '')}</td>
    `;
                tableBody.appendChild(tr);
            });
        }

        // Fetch users (same as before)
        async function fetchUsers() {
            statusEl.textContent = 'Loading usersâ€¦';
            try {
                const res = await fetch('https://jsonplaceholder.typicode.com/users');
                if (!res.ok) throw new Error('Network error');
                const data = await res.json();
                users = data;
                renderTable(users);
                statusEl.textContent = `Loaded ${users.length} users.`;
            } catch (err) {
                console.error(err);
                statusEl.textContent = 'Failed to load users.';
            }
        }

        // **New search function**
        function searchUsers() {
            const q = searchInput.value.trim().toLowerCase();
            if (!q) {
                renderTable(users);
                statusEl.textContent = `Showing all ${users.length} users.`;
                return;
            }

            function matches(value) {
                if (value === null || value === undefined) return false;
                return String(value).toLowerCase().includes(q);
            }

            // Search all fields by default
            const filtered = users.filter(u =>
                matches(u.name) ||
                matches(u.username) ||
                matches(u.email) ||
                matches(formatAddress(u.address)) ||
                matches(u.phone) ||
                matches(u.website) ||
                matches(u.company && u.company.name)
            );

            renderTable(filtered);
            statusEl.textContent = `Found ${filtered.length} user(s) for "${q}".`;
        }

        // **Event listeners**
        searchBtn.addEventListener('click', searchUsers);

        // Search as you type (automatic filtering)
        searchInput.addEventListener('input', searchUsers);

        // Clear button
        clearBtn.addEventListener('click', () => {
            searchInput.value = '';
            renderTable(users);
            statusEl.textContent = `Showing all ${users.length} users.`;
            searchInput.focus();
        });

        // Initial load
        fetchUsers();


    </script>
</body>

</html>